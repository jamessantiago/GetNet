<table id="end-table" class="mdl-data-table" width="100%" cellspacing="0">
    <thead>
        <tr>
            @if (ViewData["SiteId"] == null)
            {
            <th>Site</th>
            }
            <th>Vlan</th>
            <th>Hostname</th>
            <th>IP</th>
            <th>MAC</th>
            <th>Last Seen</th>
        </tr>
    </thead>
</table>

<script>
    var table = $('#end-table').on('processing.dt', function (e, settings, processing) {
            $('#fullpage-loading').css('display', processing ? 'block' : 'none');
    }).DataTable({
        ajax: {
            url: "/endpoint/endpointhandler",
            data: {
                siteid: "@ViewData["SiteId"]",
                text: "@ViewData["SearchText"]"
            }
        },
        processing: false,
        serverSide: true,
        columnDefs: [
            {
                targets: '_all',
                className: 'mdl-data-table__cell--non-numeric'
            }
        ],
        language: {
            search: "Filter:"
        },
        rowCallback: function (row, data) {
            var ca = 1;
            @if (ViewData["SiteId"] == null)
            {
                @:$(row).children("td").first().html('<a href="/s/' + data[0] + '">' + data[0] + "</a>");
                @:ca = 0;
            }

            $(row).attr('id', data[4 - ca] + "_row");
            $(row).children("td").last().addClass("pingme");

            $(row).children("td").last().html(data[5 - ca] + '<button id="' + data[4 - ca] + '" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">' +
                '<i class="material-icons" role="presentation">arrow_drop_down</i>' +
                '<span class="visuallyhidden">NetworkDevice</span>' +
                '</button>' +
                '<ul class="devbuts mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="' + data[4 - ca] + '">' +
                '<li id="' + data[4 - ca] + '_ping" class="pingme mdl-menu__item" data-ip="' + data[3 - ca] + '" data-colortarget="#' + data[4 - ca] + '_row"' + ' onclick="getnet.ping(\'#' + data[4 - ca] + '_ping\')">Ping</li>' +
                '<li class="mdl-menu__item" onclick="window.location.href = \'/e/' + encodeURIComponent(data[4 - ca]) + '\'">Details</li>' +
                '<li class="mdl-menu__item" onclick="window.location.href = \'/endpoint/edit/' + encodeURIComponent(data[4 - ca]) + '\'">Edit</li>' +
                '</ul>');
        },
        initComplete: function () {
            componentHandler.upgradeElements(document.querySelectorAll('.devbuts'));
        }
    });

    $(table.tables().containers()).children("div").first().children("div").first().removeClass("mdl-cell mdl-cell--6-col").addClass("mdl-cell mdl-cell--5-col");
    $(table.tables().containers()).children("div").first().prepend('' +
                '<button id="dtblbut" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">' +
                '<i class="material-icons" role="presentation">more_vert</i>' +
                '<span class="visuallyhidden">NetworkDevice</span>' +
                '</button>' +
                '<ul id="devlst" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="dtblbut">' +
                '<li class="mdl-menu__item" onclick="getnet.pingall()">Ping All</li>' +
                '</ul>');
    componentHandler.upgradeElement(document.querySelector('#devlst'));
</script>